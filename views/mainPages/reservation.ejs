<!DOCTYPE html>
<html lang="en">

<head>
  <base href="../">
  <%- include('./partials/head') %> 
</head>

<body>
  <div class="w-full">
    <div class="">
      <%- include('./partials/main_nav_bar') %>
    </div>
    <div class="grid grid-cols-1 gap-x-20 px-4 py-6 pt-16 md:px-10 lg:grid-cols-10 ">

      <div class="border-b-[1px] border-b-gray-200 col-span-1 row-start-2 lg:col-span-10 lg:row-start-1 ">
        <div class="nav-tab-line">
          <div class="flex flex-row gap-16">
            <div id="nav-stepper"
              class="flex items-center justify-center flex-wrap mb-4 lg:flex-nowrap gap-8 lg:gap-1.5 pt-5">
              <!-- Step Button -->
              <div
                class="nav-tab active text-sm leading-none relative flex items-center gap-1.5 px-5 h-11 rounded-full border border-gray-300 text-gray-600">
                <!-- Completed -->
                <i class="ki-solid opacity-0 text-lg ki-check-circle text-green-500 absolute -top-1 -end-1">
                </i>
                <!-- Icon -->
                <span class="kt-step-icon">
                  <i class="ki-filled text-lg ki-subtitle">
                  </i>
                </span>
                <!-- Step Title -->
                Informations de réservation
              </div>


              <div class="hidden lg:block w-12 h-px border-t border-dashed border-zinc-300 dark:border-zinc-600">
              </div>
              <!-- Step Button -->
              <div
                class="nav-tab text-sm leading-none relative flex items-center gap-1.5 px-5 h-11 rounded-full border border-gray-300 text-gray-600">
                <!-- Completed -->
                <i class="ki-solid opacity-0 text-lg ki-check-circle text-green-500 absolute -top-1 -end-1">
                </i>
                <!-- Icon -->
                <span class="kt-step-icon">
                  <i class="ki-filled text-lg ki-subtitle">
                  </i>
                </span>
                <!-- Step Title -->
                Payement
              </div>


            </div>
          </div>
        </div>
      </div>
      <form class="col-span-1 py-12 row-start-3 lg:col-span-6 lg:row-start-2 lg:pb-24" id="booking-form">
        <div id="form-step-1">
          <div class="mb-16">
            <p class="col-span-1 font-semibold text-xl">Période de réservation</p>
            <div class="mt-12">
              <div class="grid gap-6 mb-8">
                <div class="flex items-start flex-wrap lg:flex-nowrap gap-2.5">
                  <label class="form-label inline-block text-sm text-gray-500 mb-2 w-[40%]">
                    Date d'arrivée
                  </label>
                  <div class="flex flex-col gap-1 w-full">
                    <input type="date" name="arrivalDate"class="w-full px-3 py-3 bg-[#f7f7fa] border border-gray-200 rounded  rounded-lg focus:outline-none" />
                  </div>
                </div>

                <div class="flex items-start flex-wrap lg:flex-nowrap gap-2.5">
                  <label class="form-label inline-block text-sm text-gray-500 mb-2 w-[40%]">
                    Dae de départ
                  </label>
                  <div class="flex flex-col gap-1 w-full">
                    <input type="date" name="departureDate"
                      class="w-full px-3 py-3 bg-[#f7f7fa] border border-gray-200 rounded  rounded-lg focus:outline-none" />
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div>
            <p class="col-span-1 font-semibold text-xl">Informations personnelles</p>
            <div class="mt-12">
              <div class="grid gap-6 mb-8">
                <div class="flex items-start flex-wrap lg:flex-nowrap gap-2.5">
                  <label class="form-label inline-block text-sm text-gray-500 mb-2 w-[40%]">
                    Prénom
                  </label>
                  <div class="flex flex-col gap-1 w-full">
                    <input type="text" name="firstName"
                      class="w-full px-3 py-3 bg-[#f7f7fa] border border-gray-200 rounded  rounded-lg focus:outline-none" />
                  </div>
                </div>

                <div class="flex items-start flex-wrap lg:flex-nowrap gap-2.5">
                  <label class="form-label inline-block text-sm text-gray-500 mb-2 w-[40%]">
                    Nom
                  </label>
                  <div class="flex flex-col gap-1 w-full">
                    <input type="text" name="lastName"
                      class="w-full px-3 py-3 bg-[#f7f7fa] border border-gray-200 rounded  rounded-lg focus:outline-none" />
                  </div>
                </div>

                <div class="flex items-start flex-wrap lg:flex-nowrap gap-2.5">
                  <label class="form-label inline-block text-sm text-gray-500 mb-2 w-[40%]">
                    Téléphone
                  </label>
                  <div class="flex flex-col gap-1 w-full">
                    <input type="tel" name="phone"
                      class="w-full px-3 py-3 bg-[#f7f7fa] border border-gray-200 rounded  rounded-lg focus:outline-none" />
                  </div>
                </div>

                <div class="flex items-start flex-wrap lg:flex-nowrap gap-2.5">
                  <label class="form-label inline-block text-sm text-gray-500 mb-2 w-[40%]">
                    Email
                  </label>
                  <div class="flex flex-col gap-1 w-full">
                    <input type="text" name="email"
                      class="w-full px-3 py-3 bg-[#f7f7fa] border border-gray-200 rounded  rounded-lg focus:outline-none" />
                  </div>
                </div>

                <div class="flex items-start flex-wrap lg:flex-nowrap gap-2.5">
                  <label class="form-label inline-block text-sm text-gray-500 mb-2 w-[40%]">
                    Adresse
                  </label>
                  <div class="flex flex-col gap-1 w-full">
                    <input type="text" name="address"
                      class="w-full px-3 py-3 bg-[#f7f7fa] border border-gray-200 rounded  rounded-lg focus:outline-none" />
                      
                  </div>
                </div>


              </div>

              <div class="mb-6 flex justify-end">

                <button id="bookingInfosSubmission" type="submit"
                  class="px-8 py-4 bg-[var(--cg-accent-green)] flex gap-2 hover:bg-opacity-75 text-white rounded-xl flex">
                  <span>Suivant</span>
                  <span><i class="ki-filled ki-black-right text-xl"></i></span>

                </button>

              </div> 
            </div>
          </div>
        </div>

        <div id="form-step-2" class="hidden mt-4">
          <p class="col-span-1 font-semibold text-xl">Finaliser le paiement</p>
          <div class="mt-12">
            <div class="grid gap-4 mb-8">
             
              <div class="flex items-start flex-wrap lg:flex-nowrap gap-2.5 mb-4">
                <span class="form-label inline-block text-sm text-gray-500 w-[40%]">
                 Méthode depayement
                </span>
                <div class="flex flex-col gap-1 w-full payment-methods"> 
                  <div class="grid grid-cols-2 gap-2 w-full ">
                    <label class="cursor-pointer col-span-1 flex flex-1 flex-row gap-16 items-center py-2 px-4 transition-all duration-300 rounded-xl overflow-hidden border-2 border-gray-200 bg-[##e1e0ed52]items-center justify-between has-checked:border-green-500 has-checked:border-3">
                      <div class="font-medium h-[60px] flex flex-row items-center gap-2">
                        <span>
                          <svg width="18" height="28" viewBox="0 0 18 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                              d="M14.25 1.75C14.7141 1.75 15.1592 1.93437 15.4874 2.26256C15.8156 2.59075 16 3.03587 16 3.5V24.5C16 24.9641 15.8156 25.4092 15.4874 25.7374C15.1592 26.0656 14.7141 26.25 14.25 26.25H3.75C3.28587 26.25 2.84075 26.0656 2.51256 25.7374C2.18437 25.4092 2 24.9641 2 24.5V3.5C2 3.03587 2.18437 2.59075 2.51256 2.26256C2.84075 1.93437 3.28587 1.75 3.75 1.75H14.25ZM3.75 0C2.82174 0 1.9315 0.368749 1.27513 1.02513C0.618749 1.6815 0.25 2.57174 0.25 3.5V24.5C0.25 25.4283 0.618749 26.3185 1.27513 26.9749C1.9315 27.6313 2.82174 28 3.75 28H14.25C15.1783 28 16.0685 27.6313 16.7249 26.9749C17.3813 26.3185 17.75 25.4283 17.75 24.5V3.5C17.75 2.57174 17.3813 1.6815 16.7249 1.02513C16.0685 0.368749 15.1783 0 14.25 0L3.75 0Z"
                              class="fill-gray-500 svg" />
                            <path
                              d="M9 24.5C9.46413 24.5 9.90925 24.3156 10.2374 23.9874C10.5656 23.6592 10.75 23.2141 10.75 22.75C10.75 22.2859 10.5656 21.8408 10.2374 21.5126C9.90925 21.1844 9.46413 21 9 21C8.53587 21 8.09075 21.1844 7.76256 21.5126C7.43437 21.8408 7.25 22.2859 7.25 22.75C7.25 23.2141 7.43437 23.6592 7.76256 23.9874C8.09075 24.3156 8.53587 24.5 9 24.5Z"
                              class="fill-gray-500 svg" />
                          </svg>
                        </span>
                        <span class="text-sm text-gray-600"> Mobile money </span>
                      </div>
                      <input class="kt-radio" name="paymentMethod" type="radio" value="Mobile money">
                    </label>
  
                    <label class="checkout-option-bg cursor-pointer col-span-1 flex flex-1 flex-row gap-16 items-center py-2 px-4 transition-all duration-300 rounded-xl overflow-hidden border-2 border-gray-200 justify-between has-checked:border-green-500 has-checked:border-3 rtl:[background-position:-195px_-85px] [background-position:195px_-85px] bg-no-repeat bg-[length:650px]">
                      <div class="font-medium h-[60px] flex flex-row items-center gap-2">
                        <span>
                          <svg width="23" height="22" viewBox="0 0 23 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                              d="M17.9493 4.3999H5.05013C4.03347 4.3999 3.05844 4.77076 2.33955 5.43089C1.62066 6.09101 1.2168 6.98634 1.2168 7.9199V15.1887C1.2168 16.1223 1.62066 17.0176 2.33955 17.6777C3.05844 18.3378 4.03347 18.7087 5.05013 18.7087H17.9493C18.966 18.7087 19.941 18.3378 20.6599 17.6777C21.3788 17.0176 21.7826 16.1223 21.7826 15.1887V7.9199C21.7826 6.98634 21.3788 6.09101 20.6599 5.43089C19.941 4.77076 18.966 4.3999 17.9493 4.3999ZM2.61596 9.0023H20.3451V10.9119H2.63513L2.61596 9.0023ZM5.05013 5.6847H17.9493C18.5395 5.68755 19.1081 5.88876 19.5477 6.25032C19.9874 6.61188 20.2676 7.10875 20.3355 7.6471H2.66388C2.73179 7.10875 3.01204 6.61188 3.45169 6.25032C3.89133 5.88876 4.45995 5.68755 5.05013 5.6847ZM17.9493 17.3887H5.05013C4.40963 17.3887 3.79537 17.1551 3.34247 16.7392C2.88957 16.3233 2.63513 15.7592 2.63513 15.1711V12.1967H20.3643V15.1711C20.3643 15.4623 20.3018 15.7507 20.1805 16.0197C20.0591 16.2888 19.8812 16.5333 19.657 16.7392C19.4327 16.9451 19.1665 17.1085 18.8735 17.2199C18.5805 17.3313 18.2664 17.3887 17.9493 17.3887ZM13.5026 15.4791C13.5001 15.6534 13.4236 15.82 13.2894 15.9433C13.1551 16.0666 12.9737 16.1368 12.7839 16.1391H11.356C11.1653 16.1391 10.9825 16.0696 10.8477 15.9458C10.7129 15.822 10.6372 15.6541 10.6372 15.4791C10.6372 15.3041 10.7129 15.1362 10.8477 15.0124C10.9825 14.8886 11.1653 14.8191 11.356 14.8191H12.7839C12.9737 14.8214 13.1551 14.8917 13.2894 15.0149C13.4236 15.1382 13.5001 15.3048 13.5026 15.4791ZM19.2526 15.4791C19.2501 15.6534 19.1736 15.82 19.0394 15.9433C18.9051 16.0666 18.7237 16.1368 18.5339 16.1391H15.1414C14.9508 16.1391 14.7679 16.0696 14.6331 15.9458C14.4984 15.822 14.4226 15.6541 14.4226 15.4791C14.4226 15.3041 14.4984 15.1362 14.6331 15.0124C14.7679 14.8886 14.9508 14.8191 15.1414 14.8191H18.5435C18.7333 14.8214 18.9147 14.8917 19.049 15.0149C19.1832 15.1382 19.2597 15.3048 19.2622 15.4791H19.2526Z"
                              class="fill-gray-500 svg" />
                          </svg>
                        </span>
                        <span class="text-sm text-gray-600"> Carte bancaire</span>
                      </div>
                      <input class="kt-radio" name="paymentMethod" type="radio" value="Carte bancaire">
                    </label> 
                  </div> 
                </div> 
              </div>

              <div id="mobileMoneyInputs" class="hidden flex items-start flex-wrap lg:flex-nowrap gap-2.5">
                <label class="form-label inline-block text-sm text-gray-500 mb-2 w-[40%]">
                  Coordonnées
                </label>

                    <div id="mobileMoneyInputsWrapper" class="w-full flex flex-col gap-1 ">
                        <div class="flex gap-4  w-full">
                            <div class="flex flex-col gap-1 w-full">
                              <label class="form-label inline-block text-sm text-gray-500 mb-2">
                                     Service mobile money
                                    </label>

                                  <select name="mobileMoneyService" id="paymentService" class=" w-full text-gray-600  bg-[#f7f7fa] border border-gray-200 rounded-lg rounded-bl-lg px-4 py-3 focus:outline-none">
                                    <option value="">Sélectionner</option>
                                    <option value="togocel">Mix by Yass Togo</option>
                                    <option value="moov_tg">Moov Togo</option>
                                   <option value="mtn_open">MTN Bénin</option>
                                    <option value="moov">Moov Bénin</option>
                                    <option value="sbin">Celtiis Bénin</option>
                                    <option value="mtn_ci">MTN Côte d'Ivoire</option>
                                    <option value="airtel_ne">Airtel Niger</option>
                                    <option value="free_sn">Free Sénégal</option>
                                    <option value="mtn_open_gn">MTN Guinée</option>
                                  </select>
                            </div>
                        <div class="flex flex-col gap-1 w-full">
                            <label class="form-label inline-block text-sm text-gray-500 mb-2">
                            N° Mobile Money
                            </label>
                          <input type="tel" name="mobileMoneyNumber"class="w-full px-3 py-3 bg-[#f7f7fa] placeholder-gray-400  border border-gray-200 rounded-tr-lg rounded-lg focus:outline-none"
                          placeholder="" /> 
                        </div>
                      </div>  
                 </div>

              </div>

              <div id="cardPaymentInputs" class="hidden grid grid-cols-1 gap-6">

                <div class="flex items-start flex-wrap lg:flex-nowrap gap-2.5">
                      <label class="w-[40%]"></label>
                    <div class="flex flex-col gap-1 w-full">
                      <div class="p-6 px-4 bg-[#fef9c257] border border-yellow-300 rounded-xl text-sm text-gray-600">
                          <p class="mb-2">
                            Les paiement par carte bancaire ne sont pas disponible pour l'instant, Nos travaillons à les intégrer très bientôt.
                          </p>
                          <p class="font-medium ">
                            Merci de procéder via mobile money
                          </p>
                      </div>
                    </div>
                  </div>

                 <div class="hidden">
                   <div class="flex items-start flex-wrap lg:flex-nowrap gap-2.5">
                      <label class="form-label inline-block text-sm text-gray-500 mb-2 w-[40%]">
                        Numérode la carte
                      </label>
                    <div class="flex flex-col gap-1 w-full">
                      <input type="text" name="cardNumber"
                        class="w-full px-3 py-3 bg-[#f7f7fa] border border-gray-200 rounded  rounded-lg focus:outline-none" />
                    </div>
                </div>
                    <div class="flex items-start flex-wrap lg:flex-nowrap gap-2.5">
                      <label class="form-label inline-block text-sm text-gray-500 mb-2 w-[40%]">
                        Nom du proprietaire
                      </label>
                      <div class="flex flex-col gap-1 w-full">
                        <input type="text" name="cardHolderName"
                          class="w-full px-3 py-3 bg-[#f7f7fa] border border-gray-200 rounded  rounded-lg focus:outline-none" />
                      </div>
                    </div> 
                    <div class="flex items-start flex-wrap lg:flex-nowrap gap-2.5">
                      <label class="form-label inline-block text-sm text-gray-500 mb-2 w-[40%]">
                        Date d'xpiration et CVV
                      </label>
                  
                      <div class="flex gap-4  w-full">
                        <div class="flex flex-col gap-1 w-full">
                          <input type="text" name="expirationDate" maxlength="5"
                            class="w-full px-3 py-3 bg-[#f7f7fa] border border-gray-200 rounded rounded-lg focus:outline-none"
                            placeholder="MM/AA" />
                        </div>
                        <div class="flex flex-col gap-1 w-full">
                          <input type="text" name="CVV" maxlength="4"
                            class="w-full px-3 py-3 bg-[#f7f7fa] border border-gray-200 rounded rounded-lg focus:outline-none"
                            placeholder="CVV" />
                        </div>
                      </div>
                    </div>
                 </div>
              </div>
            </div>

          </div>

          <div class="mb-6 flex justify-end gap-6">
           <div class="w-[40%]"></div>
           <div class="flex flex-col gap-4 w-full items-end">
            <div class="submission-errors"></div>
               <div class="flex justify-end gap-4 w-full">
                 <button class="px-8 py-4 bg-gray-100 border border-gray-300 gap-2 hover:bg-opacity-75 text-gray-600 rounded-xl gap-2 flex cursor-pointer items-center">
                  <i class="ki-filled ki-black-left text-xl"></i>
                  <span>Précédent </span>
                </button>

                <button id="bookingSubmission" type="submit" class="px-8 py-4 bg-[var(--cg-accent-green)] hover:bg-opacity-75 text-white rounded-xl flex gap-2 cursor-pointer items-center">
                  <i class="ki-filled ki-wallet text-xl"></i>
                  <span>Payer</span> 
                </button>
               </div>
           </div>

          </div>

        </div>  
          <input type="text" class="hidden" name="propertyId" value="<%= listingSummary.annonce.id ? listingSummary.annonce.id : '' %>">
          <input type="text" class="hidden" name="listingOwnerModel" value="<%= listingSummary.owner && listingSummary.owner.role ? listingSummary.owner.role : '' %>">
          <input type="text" class="hidden" name="listingOwner" value="<%= listingSummary.owner && listingSummary.owner.id ? listingSummary.owner.id : '' %>">
          <input type="text" class="hidden" name="pricePerDay" value="<%- listingSummary.annonce.summary && listingSummary.annonce.summary.price ? listingSummary.annonce.summary.price : 0 %>">
          <input type="text" class="hidden" name="caution" value="<%- listingSummary.annonce.financial && listingSummary.annonce.financial.caution ? listingSummary.annonce.financial.caution : 0 %>">
          <input type="text" class="hidden" name="listingTitle" value="<%=listingSummary.annonce.summary.propertyType  %> - <% if(listingSummary.annonce.summary.hostName && listingSummary.annonce.summary.hostName.trim() !==''){ %><%=listingSummary.annonce.summary.hostName %><%} else if (!listingSummary.annonce.summary.hostName && listingSummary.annonce.summary.city === 'Lomé') { %><%=listingSummary.annonce.summary.area %><% } else { %> <%=listingSummary.annonce.summary.city%><% }%>">
    </form>
    <div class="col-span-1 mx-10 row-start-1 mb-20 lg:col-span-4 lg:row-start-2">
      <div class="rounded-xl bg-[#fafbfb] border border-gray-200 text-gray-700 px-8 py-4 relative lg:mt-[-12%]">
       
        <div class="my-3">
          <img src="assets/media/uploads/<%=listingSummary.annonce.summary.thumbnail%>" alt="" class="rounded-lg"/>
           
        </div>
        <div class="my-5">
          <p class="text-lg mb-3 font-semibold"><%=listingSummary.annonce.summary.propertyType  %> - 
            <% if (listingSummary.annonce.summary.hostName && listingSummary.annonce.summary.hostName.trim() !== '') { %>
              <%= listingSummary.annonce.summary.hostName %> 
          <% } else if (!listingSummary.annonce.summary.hostName && listingSummary.annonce.summary.city === 'Lomé') { %>
              <%= listingSummary.annonce.summary.area %> 
          <% } else { %>
              <%= listingSummary.annonce.summary.city %> 
          <% } %>
       </p>
          <p class="text-sm text-gray-500">
           <%=listingSummary.annonce.description %>
          </p>
        </div>

          <div class="pt-6 border-t border-gray-300 text-gray-600">
        <div class="flex justify-between mb-2">
            <span class="text-sm font-semibold" id="pricePerDay">
                <%= listingSummary.annonce.summary.price %> FCFA x <span id="dayCount">0</span> jrs
            </span>
            <span id="subtotal" class="text-sm font-semibold">0 FCFA</span>
        </div>
        <div class="flex justify-between mb-5">
            <span class="text-sm font-semibold">Caution</span>
            <span class="text-sm font-semibold"><%= listingSummary.annonce.financial.caution.toLocaleString('de-DE') %> FCFA</span>
        </div>
        <div class="flex justify-between font-bold text-gray-800">
            <span class="text-lg">Total:</span>
            <span id="totalAmount" class="text-lg">0 FCFA</span>
        </div>
          </div>
      </div>
    </div>

  </div>



  <%- include('./partials/footer') %>
    </div>
 <div class="modal" data-modal="true" id="submission_success">
    <div class="modal-content modal-center max-w-[400px] p-4">
      <div class="modal-body  flex flex-col items-center gap-2.5">
        <div class="flex justify-center pt-5">
          <svg width="101" height="100" viewBox="0 0 101 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="0.5" width="100" height="100" rx="50" fill="#00D095" fill-opacity="0.12" />
            <rect x="11.7422" y="11.2422" width="77.5148" height="77.5148" rx="38.7574" fill="#00D095"
              fill-opacity="0.13" />
            <rect x="24.7598" y="24.2578" width="51.4793" height="51.4793" rx="25.7396" fill="#00D095" />
            <path
              d="M58.7101 45.4386L47.7634 56.3853L42.7461 51.3681L44.0323 50.0818L47.7634 53.8037L57.4239 44.1523L58.7101 45.4386Z"
              fill="white" />
          </svg>


        </div>
        <div class="mt-4 flex-col gap-5 lg:gap-7.5">
          <div class="flex flex-col gap-1 text-center">
            <h2 class="text-1.5xl font-semibold text-gray-900">
              Succès
            </h2>
            <p class="text-sm text-gray-600">
              Votre réservation a été créée avec succès.
            </p>
          </div>
           <div class=" mt-6 mb-2 grid grid-cols-1 gap-2"> 
            <button class="back-btn px-auto py-4 bg-gray-100 border border-gray-300 gap-2 hover:bg-opacity-75 justify-center text-gray-600 rounded-xl gap-2 flex cursor-pointer items-center text-sm">
              <i class="ki-filled ki-black-left text-xl"></i>
              <span>Retours aux annonces </span>
            </button>

            <button class="redirect-btn px-auto py-4 bg-[var(--cg-accent-green)] hover:bg-opacity-75 text-white justify-center rounded-xl flex gap-2 cursor-pointer items-center text-sm">
              <span>Voir la réservation</span> 
                         <i class="ki-filled ki-black-right text-xl"></i>
            </button>

          </div>
        </div>
      </div>
    </div>
  </div>
    <div class="modal" data-modal="true" id="submission_error">
    <div class="modal-content modal-center max-w-[400px] p-4">
     <div class="modal-header !justify-end"> 
      <button class="close-btn l border-[1.5px] border-gray-300 size-8 flex items-center justify-center rounded-lg text-gray-400 close-modal" data-modal-dismiss="true">
       <i class="ki-outline ki-cross">
       </i>
      </button>
     </div>
      <div class="modal-body  flex flex-col items-center gap-2.5">
        <div class="flex justify-center pt-5">
          <svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="100" height="100" rx="50" fill="#DF3004" fill-opacity="0.12" />
            <rect x="11.2441" y="11.2422" width="77.5148" height="77.5148" rx="38.7574" fill="#DF3004"
              fill-opacity="0.13" />
            <rect x="24.2598" y="24.2617" width="51.4793" height="51.4793" rx="25.7396" fill="#DF3004" />
            <path
              d="M56.0659 57.3064L50.5009 51.7327L44.9359 57.3064L43.6934 56.0639L49.2671 50.4989L43.6934 44.9339L44.9359 43.6914L50.5009 49.2652L56.0659 43.7002L57.2996 44.9339L51.7346 50.4989L57.2996 56.0639L56.0659 57.3064Z"
              fill="white" />
          </svg>

        </div>
        <div class="flex flex-col mt-4 gap-3 mb-6 lg:gap-7.5">
          <div class="flex flex-col gap-3 text-center">
            <h2 class="text-1.5xl font-semibold text-gray-900">
              Echec
            </h2>
            <p class="text-sm text-gray-800">
              La création de l'annonce a échoué. Veuillez vérifier les informations saisies et réessayer.
            </p>
          </div>
          
          
        </div>
      </div>
    </div>
  </div>
    <div class="modal" data-modal="true" id="submission_pending">
    <div class="modal-content modal-center max-w-[400px] p-4">
     
      <div class="modal-body  flex flex-col items-center gap-2.5">
        <div class="flex justify-center pt-5">
          <img src="assets/images/pending.svg" class="w-30" alt="" srcset="">
        </div>
        <div class="flex flex-col mt-4 gap-3 mb-6 lg:gap-7.5">
          <div class="flex flex-col gap-3 text-center">
            <h2 class="text-1.5xl font-semibold text-gray-900">
              Validation
            </h2>
            <p class="text-sm text-gray-800">
              Veuillez valider la transaction sur votre téléphone en saisissant le code de compte mobile money
            </p>
          </div>
          
          
        </div>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
           // Initialize global variables from hidden inputs
        window.cartTotalValue = 0;
        const propertyIdInput = document.querySelector('input[name="propertyId"]');
        const listingOwnerModelInput = document.querySelector('input[name="listingOwnerModel"]');
        const listingOwnerInput = document.querySelector('input[name="listingOwner"]'); 
        const pricePerDayInput = document.querySelector('input[name="pricePerDay"]');
        const cautionInput = document.querySelector('input[name="caution"]');
        const listingTitleInput = document.querySelector('input[name="listingTitle"]');


        window.propertyIdValue = propertyIdInput ? propertyIdInput.value : '';
        window.listingOwnerModelValue = listingOwnerModelInput ? listingOwnerModelInput.value : '';
        window.listingOwnerValue = listingOwnerInput ? listingOwnerInput.value : '';
        window.listingTitleValue = listingTitleInput ? listingTitleInput.value : ''; 

        const bookingForm = document.getElementById('booking-form');
        if (bookingForm) {
            bookingForm.reset(); 
        }
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            modal.classList.remove('open'); 
        });

        document.body.classList.remove('overflow-hidden')

        const stepTabs = document.querySelectorAll('#nav-stepper .nav-tab');
        stepTabs.forEach((tab, index) => {
            tab.classList.remove('active', 'done');
            if (index === 0) tab.classList.add('active');
        });
        const formStep1 = document.getElementById('form-step-1');
        const formStep2 = document.getElementById('form-step-2');
        if (formStep1) formStep1.classList.remove('hidden');
        if (formStep2) formStep2.classList.add('hidden'); 

        const successModal = document.getElementById('submission_succes');
        if (successModal) {
            const backBtn = successModal.querySelector('.back-btn');
            const redirectBtn = successModal.querySelector('.redirect-btn');
            if (backBtn) {
                backBtn.onclick = () => { 
                    window.location.href = '/a-louer?t=' + new Date().getTime();
                };
            }
            if (redirectBtn) {
                redirectBtn.onclick = () => { 
                    window.location.href = '/user/reservations?t=' + new Date().getTime();
                };
            }
        }
        const errorModal = document.getElementById('submission_error');
        if (errorModal) {
            const closeBtn = errorModal.querySelector('.close-btn');
            if (closeBtn) {
                closeBtn.onclick = () => { 
                    window.location.href = window.location.pathname + '?t=' + new Date().getTime();
                };
            }
        }

        // Cart calculator
        const arrivalDateInput = document.querySelector('input[name="arrivalDate"]:not(.hidden)');
        const departureDateInput = document.querySelector('input[name="departureDate"]:not(.hidden)');
        const subtotalElement = document.getElementById('subtotal');
        const totalAmountElement = document.getElementById('totalAmount');
        const dayCountElement = document.getElementById('dayCount'); 


        // Get price and caution values
        const pricePerDay = pricePerDayInput && !isNaN(parseFloat(pricePerDayInput.value)) ? parseFloat(pricePerDayInput.value) : 0;
        const caution = cautionInput && !isNaN(parseFloat(cautionInput.value)) ? parseFloat(cautionInput.value) : 0; 

        function formatNumber(number) {
            return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        function updateCart() {
            const arrival = arrivalDateInput.value ? new Date(arrivalDateInput.value) : null;
            const departure = departureDateInput.value ? new Date(departureDateInput.value) : null;
            let days = 0;
            let subtotal = 0;
            let total = 0;

            if (arrival && departure && departure > arrival && !isNaN(arrival) && !isNaN(departure)) {
                const timeDiff = departure - arrival;
                days = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                subtotal = days * pricePerDay;
                total = subtotal + caution;
            }

            window.cartTotalValue = total;

            if (dayCountElement) dayCountElement.textContent = days;
            if (subtotalElement) subtotalElement.textContent = formatNumber(subtotal.toLocaleString('de-DE')) + ' FCFA';
            if (totalAmountElement) totalAmountElement.textContent = formatNumber(total.toLocaleString('de-DE')) + ' FCFA'; 
        }

        // Initialize cart
        updateCart();

        // Add event listeners
        if (arrivalDateInput && departureDateInput) {
            arrivalDateInput.addEventListener('change', updateCart);
            departureDateInput.addEventListener('change', updateCart);
        }
    });

    
    // </script>
</body>

<script src="/assets/js/app/addBooking.js"></script>

</html>